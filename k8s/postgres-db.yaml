# 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ my_postgres_data)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
  annotations:
    #‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡∏ï‡∏≠‡∏ô tilt down (teardown)
    tilt.dev/down-policy: 'keep'
spec:
  accessModes:
    - ReadWriteOnce # ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ Pod ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (DB) ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ
  resources:
    requests:
      storage: 1Gi # (‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)

---
# 2. ‡∏£‡∏±‡∏ô Postgres Container
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
        - name: postgres # ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ container_name
          image: postgres:latest
          ports:
            - containerPort: 5432 # Port ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
          
          # ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ DB/USER/PASS ‡∏à‡∏≤‡∏Å Secret ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á
          envFrom:
            - secretRef:
                name: postgres-secret
                
          # ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Volume ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Container
          volumeMounts:
            - name: postgres-storage
              mountPath: /var/lib/postgresql
              
      # ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ Volume ‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å PVC
      volumes:
        - name: postgres-storage
          persistentVolumeClaim:
            claimName: postgres-pvc

---
# 3. ‡πÄ‡∏õ‡∏¥‡∏î Port ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤ "5433:5432")
apiVersion: v1
kind: Service
metadata:
  name: postgres-svc
spec:
  type: NodePort # üëà ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å Cluster (localhost) ‡πÑ‡∏î‡πâ
  selector:
    app: postgres # ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Pod ‡∏Ç‡∏≠‡∏á Postgres
  ports:
    - protocol: TCP
      port: 5432       # Port ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Cluster
      targetPort: 5432 # Port ‡∏Ç‡∏≠‡∏á Container
      # 
      # Kubernetes NodePort ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 30000-32767
      # ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ 30033 ‡πÅ‡∏ó‡∏ô 5433
      #
      nodePort: 30033